<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_loan_application">
            <t t-call="web.html_container">
                <t t-if="o and 'company_id' in o">
                    <t t-set="company" t-value="o.company_id"></t>
                </t>
                <t t-if="not o or not 'company_id' in o">
                    <t t-set="company" t-value="res_company"></t>
                </t>
                <t t-foreach="docs" t-as="o">
                    <div t-attf-class="o_company_#{company.id}_layout header" t-att-style="report_header_style">
                    <div class="o_background_header">
                        <table style="width:100%;font-size:14px;">
                            <tr>
                                <td style="width:500px;text-align:center;center;">COOPERATIVA DE
                                    AHORRO Y CREDITO DE
                                    VINCULO LABORAL
                                </td>
                                <td style="width:160px"></td>
                                <td>Paginas:
                                    <span class="topage"/>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:center;center;">COA - 4 DE DICIEMBRE R.L.
                                </td>
                                <td></td>
                                <td>Fecha:
                                    <!--                                    <t t-set="now" t-value="context.get('tz').localize(fields.Datetime.now())" />-->
                                    <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d-%m-%Y %H:%M')"/>
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align:center;">LA PAZ - BOLIVIA</td>
                                <td></td>
                                <td>Usuario:
                                    <span t-esc="user.name"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div>
                        <br/>
                        <h3>
                            <center>PLAN DE PAGOS</center>
                        </h3>
                    </div>
                </div>
                    <t t-call="web.external_layout">
                        <div class="page"
                             t-att-style="'background-image: url(/rod_cooperativa_aportes/static/src/img/background_cooperativa.png);background-repeat:repeat-y; height:850px; background-position-x:center;'">
                            <div class="body">
                                <table style="width:100%; font-family:Arial;">
                                    <tr>
                                        <td>
                                            <strong>CODIGO:</strong>
                                        </td>
                                        <td>
                                            <span t-field="o.partner_id.code_contact"/>
                                        </td>
                                        <td>
                                            <strong>FECHA DE APROBACION:</strong>
                                        </td>
                                        <td>
                                            <span t-field="o.date_approval"/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>CEDULA IDENTIDAD:</strong>
                                        </td>
                                        <td>
                                            <span t-field="o.partner_id.vat"/>
                                        </td>
                                        <td>
                                            <strong>PLAZO:</strong>
                                        </td>
                                        <td>
                                            <span t-field="o.months_quantity"/>
                                        </td>

                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>ASOCIADO:</strong>
                                        </td>
                                        <td>
                                            <span t-field="o.partner_id"/>
                                        </td>
                                        <td>
                                            <strong>TASA DE INTERES</strong>
                                        </td>
                                        <td>
                                            <t t-if="o.with_guarantor == 'mortgage'">
                                                <span t-field="o.monthly_interest_mortgage"/>
                                            </t>
                                            <t t-if="o.with_guarantor == 'loan_guarantor' or o.with_guarantor == 'no_loan_guarantor'">
                                                <span t-field="o.monthly_interest"/>
                                            </t>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>GRADO:</strong>
                                        </td>
                                        <td>
                                            <span t-field="o.partner_id.category_partner_id"/>
                                        </td>
                                        <td>
                                            <strong>CAPITAL DE PRESTAMO $</strong>
                                        </td>
                                        <td>
                                            <span t-field="o.amount_loan_dollars"></span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <strong>CELULAR:</strong>
                                        </td>
                                        <td>
                                            <span t-esc="o.partner_id.mobile"></span>
                                        </td>
<!--                                        <td>-->
<!--                                            <strong>SALDO CAPITAL</strong>-->
<!--                                        </td>-->
<!--                                        <td>-->
<!--                                            <span t-field="o.balance_capital"></span>-->
<!--                                        </td>-->
                                    </tr>

                                </table>
                                <br/>
                                <table class="table text-center align-middle">
                                    <thead>
                                        <tr style="font-size:12px;">
                                            <th style="width:20px;" class="align-middle">N</th>
                                            <th style="width:20px;" class="align-middle">C.PAGO</th>
                                            <th style="width:20px;" class="align-middle">PERIODO</th>
                                            <th style="width:80px;" class="align-middle">CAP. INICIAL</th>
                                            <th style="width:80px;" class="align-middle">CUOTA FIJA</th>
                                            <th style="width:110px" class="align-middle">CAPITAL</th>
                                            <t t-if="o.with_guarantor == 'loan_guarantor' or o.with_guarantor == 'no_loan_guarantor'">
                                                <th style=" width:80px;" class="align-middle">0.7%</th>
                                            </t>
                                            <t t-if="o.with_guarantor == 'mortgage'">
                                                <th style=" width:80px;" class="align-middle">0.207%</th>
                                            </t>
                                            <t t-if="o.with_guarantor == 'loan_guarantor' or o.with_guarantor == 'no_loan_guarantor'">
                                                <th style=" width:50px;" class="align-middle">F.C.0.04%</th>
                                            </t>
                                            <t t-if="o.with_guarantor == 'mortgage'">
                                                <th style=" width:50px;" class="align-middle">P.H.0.04%</th>
                                            </t>
                                            <th style=" width:40px;" class="align-middle">SALDO CAPITAL</th>
                                            <th style=" width:40px;" class="align-middle">D/E</th>
                                            <th style=" width:40px;" class="align-middle">%COM</th>
                                            <th style=" width:40px;" class="align-middle">D/MINDEF $</th>
                                        </tr>
                                    </thead>
                                    <tbody style="font-size:12px;">
                                        <tr t-set="acumulador" t-value="0"/>
                                        <t t-set="line_number" t-value="0"/>
                                        <t t-foreach="o.loan_payment_ids" t-as="p">
                                            <style>
                                                .table th, .table td {
                                                    padding: 0px;
                                                }
                                            </style>
                                            <t t-set="line_number" t-value="line_number + 1"/>
                                            <tr style="padding:0px; margin:0px;">
                                                <td class="align-middle">
                                                    <t t-esc="line_number"/>
                                                </td>
                                                <td class="align-middle" style="font-size:8px;">
                                                    <t t-esc="p.name"/>
                                                </td>
                                                <td class="align-middle">
                                                    <t t-esc="p.period"/>
                                                </td>
                                                <td class="align-middle">
                                                    <t t-esc="round(p.capital_initial,2)"/>
                                                </td>
                                                <td class="align-middle">
                                                    <t t-esc="round(p.mount,2)"/>
                                                </td>
                                                <td class="align-middle">
                                                    <t t-esc="round(p.capital_index_initial,2)"/>
                                                </td>
                                                <t t-if="p.with_guarantor == 'loan_guarantor' or p.with_guarantor == 'no_loan_guarantor'">
                                                    <td class="align-middle">
                                                        <t t-esc="round(p.interest_base,2)"/>
                                                    </td>
                                                </t>
                                                <t t-if="p.with_guarantor=='mortgage'">
                                                    <td class="align-middle">
                                                        <t t-esc="round(p.interest_base_mortgage,2)"/>
                                                    </td>
                                                </t>
                                                <t t-if="p.with_guarantor == 'loan_guarantor' or p.with_guarantor == 'no_loan_guarantor'">
                                                    <td class="align-middle">
                                                        <t t-esc="p.res_social"/>
                                                    </td>
                                                </t>
                                                <t t-if="p.with_guarantor == 'mortgage'">
                                                    <td class="align-middle">
                                                        <t t-esc="p.res_mortgage"/>
                                                    </td>
                                                </t>
                                                <td class="align-middle">
                                                    <t t-esc="p.balance_capital"/>
                                                </td>
                                                <td class="align-middle">
                                                    <t t-esc="p.interest_month_surpluy"/>
                                                </td>
                                                <td class="align-middle">
                                                    <t t-esc="p.percentage_amount_min_def"/>
                                                </td>
                                                <td class="align-middle">
                                                    <t t-esc="p.amount_total"/>
                                                </td>
                                            </tr>

                                        </t>
                                    </tbody>
                                </table>
                                <br/>
                            </div>
                        </div>
                        <div class="oe_structure"/>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>
